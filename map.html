<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDG25IypoTEDDj0ErziE8ztDw4Xj52Cgu0&libraries=geometry&callback=initMap"
async defer></script>


<script>
	var k=0;
	var i=0;
	var j=0;
	var l=0;
	var m=0;
	var linepoly=[];
	var sta="";
	var emi="";
	var stats=[];
	var emis=[];
	var map;
	var mytable=[];
	var headingarray=[];
	var Slabels = '123456789';
	var SlabelIndex = 0;
	var Elabels = '123456789';
	var ElabelIndex = 0;

	var angle=[];
	var ang = new Array(10);
	for (var n=0; n<9; n++)
		ang[n]=new Array(10);




	function initMap()
	{
		var mapDiv = document.getElementById('mapdisplay');
	  map = new google.maps.Map(mapDiv, {
    	center: {lat: 28.6139, lng:  77.2090},
      zoom: 8
    });

		google.maps.event.addListener(map, 'mousemove', function (event) {
    	displayCoordinates(event.latLng);
    });

		function displayCoordinates(pnt)
		{
    	var coordsLabel = document.getElementById("footer");
      var lat = pnt.lat();
      lat = lat.toFixed(4);
      var lng = pnt.lng();
      lng = lng.toFixed(4);
      coordsLabel.innerHTML = "LATITUDE: " + lat + "  LONGITUDE: " + lng;
  	}

    google.maps.event.addListener(map, 'click', function(event){
		//Create a HTML Table element.
    var table = document.createElement("TABLE");
    table.border = "1";
    // check if radio button is checked
    if ($('#sta').is(':checked'))
		{
    	var location = event.latLng;
      var marker = new google.maps.Marker({
      	position:location,
				map: map,
				title: "STATION",
				label: Slabels[SlabelIndex++ % Slabels.length],
        draggable: false
			});
			var infowindow = new google.maps.InfoWindow({
    		content: 'LATITUDE: ' + location.lat().toFixed(4) + '<br>LONGITUDE: ' + location.lng().toFixed(4)
  		});
			infowindow.open(map,marker);
			sta=new google.maps.LatLng(location.lat().toFixed(4),location.lng().toFixed(4));
  		stats.push(sta);
    }
		else if($('#emi').is(':checked'))
		{
			var icon = {url: "http://maps.google.com/mapfiles/ms/icons/yellow.png",
    		scaledSize: new google.maps.Size(50, 50),
			};
			var location = event.latLng;
   		var marker = new google.maps.Marker({
   			position: location,
   			map: map,
				draggable:false,
				title: "EMITTER",
				label: Elabels[ElabelIndex++ % Elabels.length],
   			icon: icon
			});
			var infowindow = new google.maps.InfoWindow({
    		content: 'LATITUDE: ' + location.lat().toFixed(4)+ '<br>LONGITUDE: ' + location.lng().toFixed(4)
  		});
  		infowindow.open(map,marker)
			emi=new google.maps.LatLng(location.lat().toFixed(4),location.lng().toFixed(4));
			emis.push(emi);
		}

		if(stats.length>=0 && emis.length>=0)
		{
			for(i=0;i<stats.length;i++)
			{
				for(j=0;j<emis.length;j++)
				{
					var mytrip=[stats[i],emis[j]];
					var datapath=new google.maps.Polyline({
						path:mytrip,
						strokeColor:"#000000",
						strokeOpacity:1.0,
						strokeWeight:3
					});
					linepoly.push(datapath);
					var heading= google.maps.geometry.spherical.computeHeading(stats[i], emis[j]);
					headingarray.push(heading);
					ang[i][j]=heading.toFixed(4);
					restorel();
				}
			}
		}
		//Get the count of columns.
    var columnCount = (stats.length)+1;

		//Add the header row.
		var row = table.insertRow(-1);
    for (var i = 0; i < columnCount; i++)
		{
			var headerCell = document.createElement("TH");
			if(i==0)
				headerCell.innerHTML="STATIONS (side) <br> /<br> EMITTERS (down)";
			else
      	headerCell.innerHTML = "S"+i+"<br>"+stats[i-1];
      row.appendChild(headerCell);
    }

		//Add the data rows.
    for (var i = 0; i < emis.length; i++)
		{
    	row = table.insertRow(-1);
      for (var k = 0; k < columnCount; k++)
			{
				j=i+1;
        var cell = row.insertCell(-1);
			  if(k==0)
				{
        	cell.innerHTML = "E"+j+"<br>"+emis[i];
				}
				else
				{
					//cell.innerHTML=ang[k-1][i];
					if(ang[k-1][i]<0)
						cell.innerHTML=parseFloat(ang[k-1][i])+360;
					else
						cell.innerHTML=ang[k-1][i];
				}
      }
		}

		var dvTable = document.getElementById("contents");
    dvTable.innerHTML = "";
    dvTable.appendChild(table);
		})
	}

	function restorel()
	{
		for(m=0;m<linepoly.length;m++)
		{
			linepoly[m].setMap(map);
		}
	}
	function removel()
	{
		for(l=0;l<linepoly.length;l++)
		{
			linepoly[l].setMap(null);
		}
	}

</script>
</head>

<body>
	<form>
		<input type="radio" name="select" value="Station" id="sta" >STATION
		<input type="radio" name="select" value="Emitter" id="emi" >EMITTER
		<input type="button" value="RESTORE LINES" onclick="restorel();">
		<input type="button" value="REMOVE LINES" onclick="removel();">
	</form>
	<div id="mapdisplay" style="width:40%;height:800px;float:left;margin-left:10px;margin-top:17px;border:1px solid black;"></div>
	<div id="contents" style="width:50%;float:right;margin-left:10px;margin-right:10px;margin-top:17px;"></div>
	<div id="footer" ></div>
	<style type="text/css">
  	#footer {
    	position : absolute;
    	bottom : 0;
    	height : 40px;
			font-weight:bold;
    	margin-top : 40px;
  	}
	</style>
</body>
</html>
